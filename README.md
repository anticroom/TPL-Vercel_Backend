
## ðŸ› ï¸ Backend & Database Setup

The TPL template uses **Supabase** (PostgreSQL) to store levels, packs, and settings. Follow these steps to set up your backend.

### 1. Create a Supabase Project
1.  Go to [Supabase.com](https://supabase.com/) and create a free account.
2.  Click **"New Project"**.
3.  Select your organization, give the project a name (e.g., `TPL-List`), and **generate a strong Database Password**.
    * **âš ï¸ IMPORTANT:** Save this password! You will need it for the connection string later.
4.  Wait a minute for the database to provision.

### 2. Initialize the Database (SQL Script)
The template requires three specific tables: `levels`, `packs`, and `system`.

1.  In your Supabase dashboard, click the **SQL Editor** icon (on the left sidebar).
2.  Click **"New Query"**.
3.  **Copy and paste** the entire code block below into the editor.
4.  Click **Run** (bottom right).

```sql
-- 1. Create the 'levels' table to store main list data
CREATE TABLE IF NOT EXISTS levels (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    filename text NOT NULL UNIQUE,
    rank integer,
    data jsonb DEFAULT '{}'::jsonb
);

-- 2. Create the 'packs' table for map packs
CREATE TABLE IF NOT EXISTS packs (
    id text PRIMARY KEY,
    name text,
    color text,
    levels text[] DEFAULT '{}'
);

-- 3. Create the 'system' table for configs (editors, logins, rules)
CREATE TABLE IF NOT EXISTS system (
    key text PRIMARY KEY,
    data jsonb DEFAULT '{}'::jsonb
);

-- 4. Pre-populate 'system' with required keys to prevent errors
-- This sets up empty rules, an empty editor list, and a default admin user.
INSERT INTO system (key, data) VALUES
    ('_editors', '[]'::jsonb),
    ('rules', '{"level_rules": ["No hacking allowed."], "record_rules": ["Must have video proof."]}'::jsonb),
    ('_logins', '{
        "management": [
            {
                "username": "admin",
                "password": "change_me_immediately",
                "email": "admin@example.com"
            }
        ],
        "admins": []
    }'::jsonb)
ON CONFLICT (key) DO NOTHING;

```

> **Note:** The script above creates a default login:
> * **Username:** `admin`
> * **Password:** `change_me_immediately`
> 
> 
> You should log in and change this credential or update the `_logins` row in the Table Editor immediately.

### 3. Get Your Database Connection String

You need to provide your website with the address to this database.

1. Go to **Project Settings** (gear icon at the bottom left).
2. Click on **Database**.
3. Scroll down to **Connection parameters** / **Connection String**.
4. Switch the tab to **URI**.
5. Copy the Mode: **Transaction** string.
* It looks like: `postgresql://postgres.[ref]:[password]@aws-0-us-east-1.pooler.supabase.com:6543/postgres`


6. **Replace `[password]**` with the password you created in Step 1.

### 4. Configure Environment Variables

In your hosting platform (e.g., Vercel), add the `DATABASE_URL` environment variable and paste the connection string you just copied.

| Variable | Value |
| --- | --- |
| `DATABASE_URL` | `postgresql://postgres.[your-ref]:[your-password]@...` |
